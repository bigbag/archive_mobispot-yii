/*
jquery.animate-enhanced plugin v1.08
---
http://github.com/benbarnett/jQuery-Animate-Enhanced
http://benbarnett.net
@benpbarnett
---
Copyright (c) 2013 Ben Barnett

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
---
Extends jQuery.animate() to automatically use CSS3 transformations where applicable.
Tested with jQuery 1.3.2+

Supports -moz-transition, -webkit-transition, -o-transition, transition

Targetted properties (for now):
	- left
	- top
	- opacity
	- width
	- height

Usage (exactly the same as it would be normally):

	jQuery(element).animate({left: 200},  500, function() {
		// callback
	});

Changelog:
	1.08 (16/01/2014):
		- Merging PR #147 Access element tag name appropriately

	1.07 (06/12/2013):
		- Merging PR #139 Other units, beside '%' should also be kept

	1.06 (06/12/2013):
		- Merging PR #140 Do not change a user defined display mode for elements, after show/hide

	1.05 (14/08/2013):
		- Merging PR #124 fix for highcharts clash. Thanks @bensonc!

	1.04 (14/08/2013):
		- Using fix from issue #69 by @rickyk586 to support percentages

	1.03 (19/7/2013):
		- Merge PR #129 (Use originalAnimateMethod if a step callback function is provided.) /thx @lehni

	1.02 (8/5/2013):
		- Fixing use3D default flags. It must explicitly be set to false to disable 3d now, the plugin by default will use it if available.

	1.01 (8/5/2013):
		- Adding appropriate display value for wider range of elements (issue #121 - thanks smacky)

	1.0 (8/5/2103):
		- Fix avoidTransforms: true behaviour for directional transitions

	0.99.1 (3/4/2013):
		- Add Set or unset the 'disabled by default' value (PR #117)

	0.99 (5/12/2012):
		- PR #109 Added support for list-item nodes. FadeIn on tags was omitting the list-style support. (thx @SeanCannon)
		
	0.98 (12/11/2012):
		- Merging pull request #106 thx @gboysko - checking for ownerDocument before using getComputedStyle

	0.97 (6/11/2012):
		- Merging pull request #104 thx @gavrochelegnou - .bind instead of .one

	0.96a (20/08/2012):
		- Checking event is from dispatch target (issue #58)

	0.96 (20/08/2012):
		- Fixes for context, all elements returned as context (issue #84)
		- Reset position with leaveTransforms !== true fixes (issue #93)
		

	0.95 (20/08/2012):
		- If target opacity == current opacity, pass back to jquery native to get callback firing (#94)

	0.94 (20/08/2012):
		- Addresses Firefox callback mechanisms (issue #94)
		- using $.one() to bind to CSS callbacks in a more generic way

	0.93 (6/8/2012):
		- Adding other Opera 'transitionend' event (re: issue #90)

	0.92 (6/8/2012):
		- Seperate unbinds into different threads (re: issue #91)

	0.91 (2/4/2012):
		- Merge Pull Request #74 - Unit Management

	0.90 (7/3/2012):
		- Adding public $.toggleDisabledByDefault() feature to disable entire plugin by default (Issue #73)

	0.89 (24/1/2012):
		- Adding 'avoidCSSTransitions' property. Set to true to disable entire plugin. (Issue #47)

	0.88 (24/1/2012):
		- Fix Issue #67 for HighchartsJS compatibility

	0.87 (24/1/2012):
		- Fix Issue #66 selfCSSData.original is undefined

	0.86 (9/1/2012):
		- Strict JS fix for undefined variable

	0.85 (20/12/2011):
		- Merge Pull request #57 from Kronuz
		- Codebase cleaned and now passes jshint.
		- Fixed a few bugs (it now saves and restores the original css transition properties).
		- fadeOut() is fixed, it wasn't restoring the opacity after hiding it.

	0.80 (13/09/2011):
		- Issue #28 - Report $(el).is(':animated') fix

	0.79 (06/09/2011):
		- Issue #42 - Right negative position animation: please see issue notes on Github.

	0.78 (02/09/2011):
		- Issue #18 - jQuery/$ reference joys

	0.77 (02/09/2011):
		- Adding feature on Github issue #44 - Use 3D Transitions by default

	0.76 (28/06/2011):
		- Fixing issue #37 - fixed stop() method (with gotoEnd == false)

	0.75 (15/06/2011):
		- Fixing issue #35 to pass actual object back as context for callback

	0.74 (28/05/2011):
		- Fixing issue #29 to play nice with 1.6+

	0.73 (05/03/2011):
		- Merged Pull Request #26: Fixed issue with fadeOut() / "hide" shortcut

	0.72 (05/03/2011):
		- Merged Pull Request #23: Added Penner equation approximations from Matthew Lein's Ceaser, and added failsafe fallbacks

	0.71 (05/03/2011):
		- Merged Pull Request #24: Changes translation object to integers instead of strings to fix relative values bug with leaveTransforms = true

	0.70 (17/03/2011):
		- Merged Pull Request from amlw-nyt to add bottom/right handling

	0.68 (15/02/2011):
		- width/height fixes & queue issues resolved.

	0.67 (15/02/2011):
		- Code cleanups & file size improvements for compression.

	0.66 (15/02/2011):
		- Zero second fadeOut(), fadeIn() fixes

	0.65 (01/02/2011):
		- Callbacks with queue() support refactored to support element arrays

	0.64 (27/01/2011):
		- BUGFIX #13: .slideUp(), .slideToggle(), .slideDown() bugfixes in Webkit

	0.63 (12/01/2011):
		- BUGFIX #11: callbacks not firing when new value == old value

	0.62 (10/01/2011):
		- BUGFIX #11: queue is not a function issue fixed

	0.61 (10/01/2011):
		- BUGFIX #10: Negative positions converting to positive

	0.60 (06/01/2011):
		- Animate function rewrite in accordance with new queue system
		- BUGFIX #8: Left/top position values always assumed relative rather than absolute
		- BUGFIX #9: animation as last item in a chain - the chain is ignored?
		- BUGFIX: width/height CSS3 transformation with left/top working

	0.55 (22/12/2010):
		- isEmptyObject function for <jQuery 1.4 (requires 1.3.2)

	0.54a (22/12/2010):
		- License changed to MIT (http://www.opensource.org/licenses/mit-license.php)

	0.54 (22/12/2010):
		- Removed silly check for 'jQuery UI' bailouts. Sorry.
		- Scoping issues fixed - Issue #4: $(this) should give you a reference to the selector being animated.. per jquery's core animation funciton.

	0.53 (17/11/2010):
		- New $.translate() method to easily calculate current transformed translation
		- Repeater callback bug fix for leaveTransforms:true (was constantly appending properties)

	0.52 (16/11/2010):
		- leaveTransforms: true bug fixes
		- 'Applying' user callback function to retain 'this' context

	0.51 (08/11/2010):
		- Bailing out with jQuery UI. This is only so the plugin plays nice with others and is TEMPORARY.

	0.50 (08/11/2010):
		- Support for $.fn.stop()
		- Fewer jQuery.fn entries to preserve namespace
		- All references $ converted to jQuery
		- jsDoc Toolkit style commenting for docs (coming soon)

	0.49 (19/10/2010):
		- Handling of 'undefined' errors for secondary CSS objects
		- Support to enhance 'width' and 'height' properties (except shortcuts involving jQuery.fx.step, e.g slideToggle)
		- Bugfix: Positioning when using avoidTransforms: true (thanks Ralf Santbergen reports)
		- Bugfix: Callbacks and Scope issues

	0.48 (13/10/2010):
		- Checks for 3d support before applying

	0.47 (12/10/2010);
		- Compatible with .fadeIn(), .fadeOut()
		- Use shortcuts, no duration for jQuery default or "fast" and "slow"
		- Clean up callback event listeners on complete (preventing multiple callbacks)

	0.46 (07/10/2010);
		- Compatible with .slideUp(), .slideDown(), .slideToggle()

	0.45 (06/10/2010):
		- 'Zero' position bug fix (was originally translating by 0 zero pixels, i.e. no movement)

	0.4 (05/10/2010):
		- Iterate over multiple elements and store transforms in jQuery.data per element
		- Include support for relative values (+= / -=)
		- Better unit sanitization
		- Performance tweaks
		- Fix for optional callback function (was required)
		- Applies data[translateX] and data[translateY] to elements for easy access
		- Added 'easeInOutQuint' easing function for CSS transitions (requires jQuery UI for JS anims)
		- Less need for leaveTransforms = true due to better position detections
*/(function(e,t,n){function S(e){return e.match(/\D+$/)}function x(t,n,r,i){if(r=="d")return;if(!M(t))return;var s=u.exec(n),o=t.css(r)==="auto"?0:t.css(r),a=typeof o=="string"?O(o):o,f=typeof n=="string"?O(n):n,l=i===!0?0:a,c=t.is(":hidden"),h=t.translation();r=="left"&&(l=parseInt(a,10)+h.x);r=="right"&&(l=parseInt(a,10)+h.x);r=="top"&&(l=parseInt(a,10)+h.y);r=="bottom"&&(l=parseInt(a,10)+h.y);if(!s&&n=="show"){l=1;if(c){elem=t[0];if(elem.style){display=elem.style.display;!e._data(elem,"olddisplay")&&display==="none"&&(display=elem.style.display="");display===""&&e.css(elem,"display")==="none"&&e._data(elem,"olddisplay",A(elem.tagName));if(display===""||display==="none")elem.style.display=e._data(elem,"olddisplay")||""}t.css("opacity",0)}}else!s&&n=="hide"&&(l=0);if(s){var p=parseFloat(s[2]);s[1]&&(p=(s[1]==="-="?-1:1)*p+parseInt(l,10));s[3]&&s[3]!="px"&&(p+=s[3]);return p}return l}function T(e,t,n){return n===!0||E===!0&&n!==!1&&w?"translate3d("+e+"px, "+t+"px, 0)":"translate("+e+"px,"+t+"px)"}function N(t,n,r,s,o,u,a,l){var h=t.data(c),p=h&&!L(h)?h:e.extend(!0,{},f),d=o,v=e.inArray(n,i)>-1;if(v){var m=p.meta,g=O(t.css(n))||0,y=n+"_o";d=o-g;m[n]=d;m[y]=t.css(n)=="auto"?0+d:g+d||0;p.meta=m;if(a&&d===0){d=0-m[y];m[n]=d;m[y]=0}}return t.data(c,C(t,p,n,r,s,d,u,a,l))}function C(e,t,n,r,i,o,u,a,f){var l=!1,c=u===!0&&a===!0;t=t||{};if(!t.original){t.original={};l=!0}t.properties=t.properties||{};t.secondary=t.secondary||{};var h=t.meta,p=t.original,d=t.properties,v=t.secondary;for(var m=s.length-1;m>=0;m--){var g=s[m]+"transition-property",y=s[m]+"transition-duration",b=s[m]+"transition-timing-function";n=c?s[m]+"transform":n;if(l){p[g]=e.css(g)||"";p[y]=e.css(y)||"";p[b]=e.css(b)||""}v[n]=c?T(h.left,h.top,f):o;d[g]=(d[g]?d[g]+",":"")+n;d[y]=(d[y]?d[y]+",":"")+r+"ms";d[b]=(d[b]?d[b]+",":"")+i}return t}function k(e){for(var t in e)if((t=="width"||t=="height")&&(e[t]=="show"||e[t]=="hide"||e[t]=="toggle"))return!0;return!1}function L(e){for(var t in e)return!1;return!0}function A(e){e=e.toUpperCase();var t={LI:"list-item",TR:"table-row",TD:"table-cell",TH:"table-cell",CAPTION:"table-caption",COL:"table-column",COLGROUP:"table-column-group",TFOOT:"table-footer-group",THEAD:"table-header-group",TBODY:"table-row-group"};return typeof t[e]=="string"?t[e]:"block"}function O(e){return parseFloat(e.replace(S(e),""))}function M(e){var t=!0;e.each(function(e,n){t=t&&n.ownerDocument;return t});return t}function _(t,n,i){if(!M(i))return!1;var s=e.inArray(t,r)>-1;(t=="width"||t=="height"||t=="opacity")&&parseFloat(n)===parseFloat(i.css(t))&&(s=!1);return s}var r=["top","right","bottom","left","opacity","height","width"],i=["top","right","bottom","left"],s=["-webkit-","-moz-","-o-",""],o=["avoidTransforms","useTranslate3d","leaveTransforms"],u=/^([+-]=)?([\d+-.]+)(.*)$/,a=/([A-Z])/g,f={secondary:{},meta:{top:0,right:0,bottom:0,left:0}},l="px",c="jQe",h="cubic-bezier(",p=")",d=null,v=!1,m=document.body||document.documentElement,g=m.style,y="webkitTransitionEnd oTransitionEnd transitionend",b=g.WebkitTransition!==undefined||g.MozTransition!==undefined||g.OTransition!==undefined||g.transition!==undefined,w="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,E=w;if(e.expr&&e.expr.filters){d=e.expr.filters.animated;e.expr.filters.animated=function(t){return e(t).data("events")&&e(t).data("events")[y]?!0:d.call(this,t)}}e.extend({toggle3DByDefault:function(){return E=!E},toggleDisabledByDefault:function(){return v=!v},setDisabledByDefault:function(e){return v=e}});e.fn.translation=function(){if(!this[0])return null;var e=this[0],t=window.getComputedStyle(e,null),n={x:0,y:0};if(t)for(var r=s.length-1;r>=0;r--){var i=t.getPropertyValue(s[r]+"transform");if(i&&/matrix/i.test(i)){var o=i.replace(/^matrix\(/i,"").split(/, |\)$/g);n={x:parseInt(o[4],10),y:parseInt(o[5],10)};break}}return n};e.fn.animate=function(n,r,u,a){n=n||{};var f=typeof n.bottom=="undefined"&&typeof n.right=="undefined",d=e.speed(r,u,a),m=0,g=function(){m--;m===0&&typeof d.complete=="function"&&d.complete.apply(this,arguments)},w=typeof n.avoidCSSTransitions!="undefined"?n.avoidCSSTransitions:v;return w===!0||!b||L(n)||k(n)||d.duration<=0||d.step?t.apply(this,arguments):this[d.queue===!0?"queue":"each"](function(){var r=e(this),u=e.extend({},d),a=function(t){var o=r.data(c)||{original:{}},u={};if(t.eventPhase!=2)return;if(n.leaveTransforms!==!0){for(var a=s.length-1;a>=0;a--)u[s[a]+"transform"]="";if(f&&typeof o.meta!="undefined")for(var h=0,p;p=i[h];++h){u[p]=o.meta[p+"_o"]+l;e(this).css(p,u[p])}}r.unbind(y).css(o.original).css(u).data(c,null);if(n.opacity==="hide"){elem=r[0];if(elem.style){display=e.css(elem,"display");display!=="none"&&!e._data(elem,"olddisplay")&&e._data(elem,"olddisplay",display);elem.style.display="none"}r.css("opacity","")}g.call(this)},v={bounce:h+"0.0, 0.35, .5, 1.3"+p,linear:"linear",swing:"ease-in-out",easeInQuad:h+"0.550, 0.085, 0.680, 0.530"+p,easeInCubic:h+"0.550, 0.055, 0.675, 0.190"+p,easeInQuart:h+"0.895, 0.030, 0.685, 0.220"+p,easeInQuint:h+"0.755, 0.050, 0.855, 0.060"+p,easeInSine:h+"0.470, 0.000, 0.745, 0.715"+p,easeInExpo:h+"0.950, 0.050, 0.795, 0.035"+p,easeInCirc:h+"0.600, 0.040, 0.980, 0.335"+p,easeInBack:h+"0.600, -0.280, 0.735, 0.045"+p,easeOutQuad:h+"0.250, 0.460, 0.450, 0.940"+p,easeOutCubic:h+"0.215, 0.610, 0.355, 1.000"+p,easeOutQuart:h+"0.165, 0.840, 0.440, 1.000"+p,easeOutQuint:h+"0.230, 1.000, 0.320, 1.000"+p,easeOutSine:h+"0.390, 0.575, 0.565, 1.000"+p,easeOutExpo:h+"0.190, 1.000, 0.220, 1.000"+p,easeOutCirc:h+"0.075, 0.820, 0.165, 1.000"+p,easeOutBack:h+"0.175, 0.885, 0.320, 1.275"+p,easeInOutQuad:h+"0.455, 0.030, 0.515, 0.955"+p,easeInOutCubic:h+"0.645, 0.045, 0.355, 1.000"+p,easeInOutQuart:h+"0.770, 0.000, 0.175, 1.000"+p,easeInOutQuint:h+"0.860, 0.000, 0.070, 1.000"+p,easeInOutSine:h+"0.445, 0.050, 0.550, 0.950"+p,easeInOutExpo:h+"1.000, 0.000, 0.000, 1.000"+p,easeInOutCirc:h+"0.785, 0.135, 0.150, 0.860"+p,easeInOutBack:h+"0.680, -0.550, 0.265, 1.550"+p},b={},w=v[u.easing||"swing"]?v[u.easing||"swing"]:u.easing||"swing";for(var E in n)if(e.inArray(E,o)===-1){var S=e.inArray(E,i)>-1,T=x(r,n[E],E,S&&n.avoidTransforms!==!0);_(E,T,r)?N(r,E,u.duration,w,T,S&&n.avoidTransforms!==!0,f,n.useTranslate3d):b[E]=n[E]}r.unbind(y);var C=r.data(c);if(C&&!L(C)&&!L(C.secondary)){m++;r.css(C.properties);var k=C.secondary;setTimeout(function(){r.bind(y,a).css(k)})}else u.queue=!1;if(!L(b)){m++;t.apply(r,[b,{duration:u.duration,easing:e.easing[u.easing]?u.easing:e.easing.swing?"swing":"linear",complete:g,queue:u.queue}])}return!0})};e.fn.animate.defaults={};e.fn.stop=function(t,r,i){if(!b)return n.apply(this,[t,r]);t&&this.queue([]);this.each(function(){var o=e(this),u=o.data(c);if(u&&!L(u)){var f,h={};if(r){h=u.secondary;if(!i&&typeof u.meta.left_o!==undefined||typeof u.meta.top_o!==undefined){h.left=typeof u.meta.left_o!==undefined?u.meta.left_o:"auto";h.top=typeof u.meta.top_o!==undefined?u.meta.top_o:"auto";for(f=s.length-1;f>=0;f--)h[s[f]+"transform"]=""}}else if(!L(u.secondary)){var p=window.getComputedStyle(o[0],null);if(p)for(var d in u.secondary)if(u.secondary.hasOwnProperty(d)){d=d.replace(a,"-$1").toLowerCase();h[d]=p.getPropertyValue(d);if(!i&&/matrix/i.test(h[d])){var v=h[d].replace(/^matrix\(/i,"").split(/, |\)$/g);h.left=parseFloat(v[4])+parseFloat(o.css("left"))+l||"auto";h.top=parseFloat(v[5])+parseFloat(o.css("top"))+l||"auto";for(f=s.length-1;f>=0;f--)h[s[f]+"transform"]=""}}}o.unbind(y);o.css(u.original).css(h).data(c,null)}else n.apply(o,[t,r])});return this}})(jQuery,jQuery.fn.animate,jQuery.fn.stop);